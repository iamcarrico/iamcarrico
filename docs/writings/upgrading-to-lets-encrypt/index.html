<!DOCTYPE html><html class="no-js" lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Upgrading to Let's Encrypt</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta property="og:title" content="Upgrading to Let's Encrypt"><meta property="og:type" content="article"><meta property="og:description" content="How I used Let's Encrypt for my own SSL/TLS certificates on all of my web servers."><meta property="article:published_time" content="2016-09-30T07:00:00-05:00"><meta property="article:author" content="https://iamcarrico.com/about/"><meta property="og:url" content="https://iamcarrico.com/writings/upgrading-to-lets-encrypt/"><link rel="canonical" href="/writings/upgrading-to-lets-encrypt/"><meta property="og:image" content="https://iamcarrico.com//img/2016/gold-lock_md.jpg"><meta property="article:tag" content="security"><meta property="article:tag" content="server"><meta property="article:tag" content="nginx"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@iamcarrico"><meta name="twitter:creator" content="@iamcarrico"><meta name="twitter:title" content="Upgrading to Let's Encrypt"><meta name="twitter:description" content="How I used Let's Encrypt for my own SSL/TLS certificates on all of my web servers."><meta name="twitter:image" content="https://iamcarrico.com//img/2016/gold-lock_md.jpg"><style>/*! normalize.css v3.0.0 | MIT License | git.io/normalize */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 0}hr{box-sizing:border-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}html{box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}embed,img,object,video{max-width:100%;height:auto}header:after,main:after,.blog-post.teaser:after,.recipie-card:after,footer .inner:after{content:"";display:table;clear:both}header,footer .inner{max-width:50em;margin:0 auto 0}.highlight{background:#fff}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:teal}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:teal}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}.highlight pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}body{font-family:Helvetica,Arial,"Nimbus Sans L",sans-serif;font-size:17px;line-height:24px;color:#333}.fonts-loaded body,body.fonts-loaded{font-family:"pt",Helvetica,Arial,"Nimbus Sans L",sans-serif}h1,h2,h3,h4,h5,h6{font-family:Helvetica,Arial,"Nimbus Sans L",sans-serif;font-weight:normal}.fonts-loaded h1,h1.fonts-loaded,.fonts-loaded h2,h2.fonts-loaded,.fonts-loaded h3,h3.fonts-loaded,.fonts-loaded h4,h4.fonts-loaded,.fonts-loaded h5,h5.fonts-loaded,.fonts-loaded h6,h6.fonts-loaded{font-family:"pt",Helvetica,Arial,"Nimbus Sans L",sans-serif}h1{line-height:1.2}a{text-decoration:none;transition:color .3s;color:#2090b4}a:link{color:#2090b4}a:visited{color:#2090b4}a:hover,a:focus{color:#10485a}ul ul,ul ol,ol ol,ol ul{margin-bottom:0}hr{border:0;height:1px;background:#333;background-image:linear-gradient(to right,#ccc,#333,#ccc)}strong{font-weight:bold}em{font-style:italic}blockquote{border-left:3px #333 solid;margin-left:1em;padding-left:.4em;font-style:italic}figure{display:block;position:relative;overflow:hidden}figcaption,figure:before{position:absolute;background:rgba(0,0,0,0.75);font-size:.9em;color:white;bottom:0;transition:all .4s ease}figcaption{padding:.1em .25em;opacity:0;left:-30%;font-style:italic}figure:hover figcaption{opacity:1;left:0}figure:before{content:"?";width:24px;height:24px;border-radius:12px;text-align:center;line-height:24px;opacity:.75}figure:hover:before{opacity:0}::selection{background:#66b360;color:#fff;text-shadow:none}@font-face{font-family:'pt';font-style:normal;font-weight:normal;src:url("/fonts/pt.woff2?1407277128") format("woff2"),url("/fonts/pt.woff?1407277128") format("woff"),url("/fonts/pt.ttf?1407277128") format("truetype")}@font-face{font-family:'pt';font-style:italic;font-weight:normal;src:url("/fonts/pt-italic.woff2?1407277128") format("woff2"),url("/fonts/pt-italic.woff?1407277128") format("woff"),url("/fonts/pt-italic.ttf?1407277128") format("truetype")}@font-face{font-family:'icomoon';src:url("/fonts/icomoon.eot?ifts57");src:url("/fonts/icomoon.eot?#iefixifts57") format("embedded-opentype"),url("/fonts/icomoon.ttf?ifts57") format("truetype"),url("/fonts/icomoon.woff?ifts57") format("woff"),url("/fonts/icomoon.svg?ifts57#icomoon") format("svg");font-weight:normal;font-style:normal}.icon{font-family:'icomoon';speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;letter-spacing:0;-webkit-font-feature-settings:"liga";font-feature-settings:"liga";-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:1.2em;position:relative;left:0;display:inline-block;top:.15em}form{max-width:525px}input,button,select,textarea{display:block;width:100%;font-family:"pt",Helvetica,Arial,"Nimbus Sans L",sans-serif;padding:.375em;outline:0;margin-bottom:1em;transition:box-shadow .3s ease-out,border .3s ease-out}input:focus,button:focus,select:focus,textarea:focus{border-color:#1c7f9e;background-color:#fff;box-shadow:0 0 4px rgba(32,144,180,0.5)}@media(min-width:720px){input,button,select,textarea{width:75%}}.required{color:red}@media(min-width:720px){label{width:25%;float:left;text-align:right;padding:.375em .5em}}.submit,button,input[type="submit"],input[type="reset"],input[type="button"]{width:auto;float:right;border:1px solid #c6c6c6;line-height:1.8em;padding:0 3em;background-color:#cdcdcd;border-radius:2px}.submit:hover,button:hover,input[type="submit"]:hover,input[type="reset"]:hover,input[type="button"]:hover{background-color:#8ea4ac}header{position:relative}header .title{float:left;width:75%;font-size:4em;line-height:1em;margin:0}header .title .word{display:block}header .title a,header .title a:link,header .title a:visited{color:#333}@media(min-width:33.25em){header .title{margin-top:1em}header .title .word{display:inline}}header nav{width:25%;float:right}header nav .menubar,header nav .menuitem{display:block;margin-bottom:.5em;padding-right:.25em;width:100%;text-align:right}@media(min-width:23em){header nav{width:100%;position:absolute}header nav .menuitem{display:inline-block;width:auto;margin-left:.75em}header nav .menuitem:first-child{margin-left:0}}@media(min-width:33.25em){header nav{margin:1em 1em 0 0}}main{max-width:45em;margin:0 auto;padding:.5em}@media(min-width:400px){#about img{width:50%;float:right;margin:0 0 1em 1em}}#contact ul li{list-style-type:none}#contact li{margin-bottom:.5em;display:block}#contact .g-recaptcha{float:right;margin-bottom:1em}#contact .submit{clear:right}.blog-post .title{text-transform:uppercase;margin-bottom:5px;line-height:1.1}.blog-post .hero-image{margin-top:1em}.blog-post.full{float:left;width:100%}.blog-post.teaser{margin-bottom:40px}@media(min-width:400px){.blog-post.teaser .teaser-image{float:left;max-width:30%;max-height:200px;margin-right:1em}.blog-post.teaser:nth-child(even) .teaser-image{float:right}}.talk .links{list-style-type:none;padding-left:0}.talk .links li{display:inline-block;margin-right:2em}.category{font-style:italic}.category:after{content:', '}.category:last-child:after{content:''}.recipie-card{padding:1em;border:1px solid black;margin:2em}.recipie-card--image{float:right;max-width:45%;margin-left:.5em}footer{background-color:#e6e6e6;width:100%}footer .inner{padding:0 .5em 1em;font-size:1.05em}footer .contact a{float:left;clear:left;padding:.15em 0;margin-bottom:.25em;width:auto}footer .copyright{padding:.25em 0;display:block;clear:both}</style></head><body><header><h1 class="site-name title"><a href="/"><span class="word">I. </span><span class="word">Am. </span><span class="word">Carrico.</span></a></h1><nav id="nav" role="navigation"><div class="menubar" role="menubar"><a class="menuitem" role="menuitem" href="/">Home</a> <a class="menuitem" role="menuitem" href="/about/">About</a> <a class="menuitem" role="menuitem" href="/contact/">Contact</a> <a class="menuitem" role="menuitem" href="/talks/">Talks</a> <a class="menuitem" role="menuitem" href="/the-boys-club/">The Boys Club</a> <a class="menuitem icon" role="menuitem" href="feed.xml">rss&nbsp;feed</a></div></nav></header><main role="main"><article class="blog-post full"><h1 class="title">Upgrading to Let's Encrypt</h1><div class="metadatas"><span class="categories"><span class="category">security</span> <span class="category">server</span> <span class="category">nginx</span> </span>&nbsp;-&nbsp; <span class="date">2016-09-30</span></div><div class="content"><figure><img src="/img/2016/gold-lock_md.jpg" srcset="/img/2016/gold-lock_sm.jpg 350w, /img/2016/gold-lock_md.jpg 748w, /img/2016/gold-lock_lg.jpg 1496w" alt="A gold lock on a blue door."><figcaption><a href="https://www.flickr.com/photos/fischerfotos/7454996046/" target="\_blank">Gold Lock</a> by <a href="https://www.flickr.com/photos/fischerfotos/" target="\_blank">Mark Fischer</a> / <a href="https://creativecommons.org/licenses/by-sa/2.0/" target="\_blank">CC BY-SA 2.0</a></figcaption></figure><p><a href="https://theintercept.com/2014/08/15/cat-video-hack/">HTTPS is important</a>. It is a requirement for all browser implementations of HTTP/2, service workers, and <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Mozilla is depreciating non-secure HTTP</a>. But HTTPS can be hard, and takes more time to setup than what we are used to— not to mention you need to get certificates, and the headache continues.</p><p>If you are in this position, stop and read through <a href="https://twitter.com/tollmanz">Zack Tollman</a>&#39;s (from Wired) <a href="https://speakerdeck.com/tollmanz/https-is-coming-are-you-prepared-velocity-2016">slides on HTTPS right now</a>. It is a great presentation given at Velocity this year that goes over everything you need to know about HTTPS.</p><p>Now, I have been using HTTPS for some time, but all of my certificates were from Comodo. Due to the revelations of their <a href="https://letsencrypt.org/2016/06/23/defending-our-brand.html">recent antics</a>, I decided it would be wise to move my certificates over to <a href="https://letsencrypt.org/">Let&#39;s Encrypt</a>. The process was fairly straight-forward, but to clear up anything in the documentation I wanted to share how I moved over.</p><h2 id="what-is-let&#39;s-encrypt">What is Let&#39;s Encrypt</h2><p>Let&#39;s Encrypt is a <a href="https://letsencrypt.org/about/">free, secure, automatic, transparent, open, and cooperative </a>certificate authority that allows anybody who owns a domain to get a free SSL/TLS certificate. It has taken the internet by storm, prompting more people the ability to make their sites more secure, and making it free and easy to do so. Needless to say, I was very excited to move to a better way of handling my own certificates.</p><h2 id="my-requirements">My requirements</h2><p>Since everybody&#39;s implementation will be slightly different depending on their setup, this is what I am using on mine.</p><ul><li>I am using Ubuntu 14.04 (Trusty)</li><li>My server ends with nginx</li><li><a href="/writings/how-and-why-i-made-my-own-cdn/">I have multiple servers that I serve up my primary domain</a></li></ul><h2 id="getting-a-certificates">Getting a certificates</h2><p>First off, I updated my <a href="https://github.com/iamcarrico/iamcarrico.server/blob/master/ansible/roles/certs/tasks/main.yml#L6-L8">playbooks</a> to download <a href="https://certbot.eff.org/">certbot</a> by the EFF. If you are not using Ansible then you can run the following (as root) to download the scripts.</p><p>Note: For this, most of my actions I did as root to ensure permissions are right on the certificates.</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Become the superuser `root`</span>
sudo su

<span class="c"># Move into the home directory of root</span>
<span class="nb">cd</span>

<span class="c"># Download Certbot</span>
wget https://dl.eff.org/certbot-auto

<span class="c"># Alter certbot so you can execute it.</span>
chmod o+x certbot-auto
</code></pre></div><p>Running certbot the first time (<code>./certbot-auto</code>) will then download and install all needed packages for you to run.</p><p>From here, there are several ways to validate your server and get your certificates from <code>certbot</code>. Because my server has taken over port 80 and port 443 (TLS/SSL), and redirects all insecure traffic already— I chose to exercise the manual option. For this, you will need two tabs open, both on the server that you will be getting a certificate for.</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Just a reminder to be root, and be in the root&#39;s home directory.</span>
sudo su
<span class="nb">cd</span>

<span class="c"># Now, we request the certificate.</span>
./certbot-auto certonly --manual
</code></pre></div><p>From here, you will be prompted for your email (for key recovery) and the domain name you want for the certificate. <code>Certbot</code> will then give you some code to copy and paste into your second window. This code will create a python server to confirm your ownership of the domain. You may have to shut off nginx temporarily for this to work.</p><h3 id="multiple-severs,-one-domain">Multiple severs, one domain</h3><p>I used the above method for all of my server&#39;s own endpoint (e.g. <a href="https://newyork.iamcarrico.com">newyork.iamcarrico.com</a>), but my primary domain is spread out on 4 different servers. For this, I used my New York server as the primary server. I ran the same code as I did before, but then copy/pasted the code Let&#39;s Encrypt gave me on each server. Thus, whichever server Let&#39;s Encrypt tested from, the same response would be given. I then used sftp to move the certificates for my primary domain to all four servers that use them.</p><h2 id="updating-nginx">Updating nginx</h2><p>Once all of the servers have the right certificates, updating nginx was just a matter of ensuring the servers were pointing at the right certificate. Within my Ansible templates, I created the following configuration:</p><div class="highlight"><pre><code class="language-text" data-lang="text">ssl on;
ssl_certificate /etc/letsencrypt/live/{ server_name_template }/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/{ server_name_template }/privkey.pem;
</code></pre></div><p>Where the <code>{ server_name_template }</code> is replaced by the domain name that we are building for. Either <code>iamcarrico.com</code>, or the individual server that is being used (e.g <code>amsterdam.iamcarrico.com</code>). A quick restart to the nginx server, and my sites are up and running with Let&#39;s Encrypt.</p><h3 id="multiple-servers,-redux">Multiple servers, redux</h3><p>The problem with my method above, is that it requires a lot of manual work every 90 days or so as certificates expire from Let&#39;s Encrypt. I wanted a way of more easily updating my certificates automatically, and received an idea from <a href="https://community.letsencrypt.org/t/will-lets-encrypt-work-for-me-multiple-servers-serving-one-domain/6830/8/">an article on the Let&#39;s Encrypt community boards</a>.</p><p>I altered my Let&#39;s Encrypt setup to use the webroot method, where it will check a specific file exists on my server to confirm ownership. I have set <code>newyork.iamcarrico.com</code> set as my primary domain that will hold / renew the primary certificate. All other domains use nginx&#39;s <code>proxy_pass</code> to redirect to newyork for the certificate confirmation. Within nginx, this looks like:</p><div class="highlight"><pre><code class="language-text" data-lang="text">location /.well-known/ {
  proxy_pass https://newyork.iamcarrico.com;
}
</code></pre></div><p>Or for newyork:</p><div class="highlight"><pre><code class="language-text" data-lang="text">location /.well-known/ {
  root /var/www/acme-challenge/;
}
</code></pre></div><p>Which will then hold the challenge that Let&#39;s Encrypt uses to confirm domain ownership. The full code for this <a href="https://github.com/iamcarrico/iamcarrico.server/blob/master/ansible/roles/site_config/templates/iamcarrico.j2#L37-L49">can be found in my Ansible playbooks</a>, and thus far has worked fairly well.</p><p>Now, the only manual work I need to do is moving the certificate from one server to another. As of yet, I have not figured out the best way to handle this automatically— but am working on several ideas.</p><h2 id="renewals">Renewals</h2><p>Let&#39;s Encrypt&#39;s certificates expire after 90 days. They do this to prevent issues with <a href="https://letsencrypt.org/2015/11/09/why-90-days.html">key compromise, mis-issuances, but also to encourage automation</a>. Since I moved my configuration with Let&#39;s Encrypt to use the <code>webroot</code> method, all I need to do is run the command:</p><div class="highlight"><pre><code class="language-text" data-lang="text">./certbot-auto renew
</code></pre></div><p>Which will automatically renew my certificates when they are close to expiration. For most people, they can setup a cronjob with Asible with:</p><div class="highlight"><pre><code class="language-text" data-lang="text">- name: Create a cron task to renew the certificates every other month
 cron:
   name: &quot;letsencrypt renew&quot;
   hour:  &quot;8,20&quot;
   user:   root
   cron_file: letsencrypt_renew
   job: &#39;/root/certbot-auto renew -q --post-hook &quot;service nginx restart&quot;&#39;
</code></pre></div><p>This will run twice a day (it will only renew when needed). After certbot-auto runs, it will then restart nginx to accept the new certificates.</p><p>But, since I need to move my certificates from the primary server, and distribute them to the rest of the servers— this solution will not work perfectly for me. I am working on scripts that will securely share the right files to each server, although as of now that is purely manual.</p><h2 id="should-i-use-let&#39;s-encrypt?">Should I use Let&#39;s Encrypt?</h2><p>Yes. Absolutely.</p><p>Using <a href="https://certbot.eff.org/">the EFF&#39;s certbot-auto</a> it is quick and easy to setup the certificates for a single server and machine. Even doing it on multiple servers just takes a little bit of finagling, but isn&#39;t too difficult.</p><p>To give an idea of the ease, I originally set up my certificates on Southwest&#39;s in-air Wi-Fi, and still did not have an issue at all. The process is quick, painless, and you can have a secure website before you know it.</p></div><div class="comments"><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'iamcarrico';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div></article></main><footer role="contentinfo"><div class="inner"><span class="contact"><a href="https://github.com/iamcarrico/" target="_blank" class="github"><span class="icon">github</span> github.com/iamcarrico</a> <a href="https://twitter.com/iamcarrico/" target="_blank" class="twitter"><span class="icon">twitter</span> twitter.com/iamcarrico</a> <a href="https://www.goodreads.com/iamcarrico" target="_blank" class="goodreads"><span class="icon">goodreads</span> goodreads.com/iamcarrico</a> </span><span class="copyright">&copy; 2019 Ian Carrico</span></div></footer><script async src="https://www.google-analytics.com/analytics.js"></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-40742161-1', 'auto', {'siteSpeedSampleRate': 100});
ga('send', 'pageview', {transport: 'beacon'});</script><script>!function(){"use strict";function t(t){function e(){document.body?t():setTimeout(e,0)}e()}function e(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.g=document.createElement("span"),this.f=-1,this.b.style.cssText="display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;",this.c.style.cssText="display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;",this.g.style.cssText="display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;",this.h.style.cssText="display:inline-block;width:200%;height:200%;",this.b.appendChild(this.h),this.c.appendChild(this.g),this.a.appendChild(this.b),this.a.appendChild(this.c)}function n(t,e,n){t.a.style.cssText="min-width:20px;min-height:20px;display:inline-block;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font-size:100px;font-family:"+e+";"+n}function i(t){var e=t.a.offsetWidth,n=e+100;return t.g.style.width=n+"px",t.c.scrollLeft=n,t.b.scrollLeft=t.b.scrollWidth+100,t.f!==e?(t.f=e,!0):!1}function o(t,e){t.b.addEventListener("scroll",function(){i(t)&&null!==t.a.parentNode&&e(t.f)},!1),t.c.addEventListener("scroll",function(){i(t)&&null!==t.a.parentNode&&e(t.f)},!1),i(t)}function r(t){p.push(t),1===p.length&&v()}function a(){for(;p.length;)p[0](),p.shift()}function s(t){this.a=g,this.b=void 0,this.c=[];var e=this;try{t(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(n){e.reject(n)}}function c(t){return new s(function(e,n){n(t)})}function l(t){return new s(function(e){e(t)})}function u(t){r(function(){if(t.a!==g)for(;t.c.length;){var e=t.c.shift(),n=e[0],i=e[1],o=e[2],e=e[3];try{0===t.a?o("function"==typeof n?n.call(void 0,t.b):t.b):1===t.a&&("function"==typeof i?o(i.call(void 0,t.b)):e(t.b))}catch(r){e(r)}}})}function h(t){return new s(function(e,n){function i(n){return function(i){r[n]=i,o+=1,o===t.length&&e(r)}}var o=0,r=[];0===t.length&&e(r);for(var a=0;a<t.length;a+=1)t[a].then(i(a),n)})}function d(t){return new s(function(e,n){for(var i=0;i<t.length;i+=1)t[i].then(e,n)})}function f(t,e){var n=e||{};this.family=t,this.style=n.style||"normal",this.variant=n.variant||"normal",this.weight=n.weight||"normal",this.stretch=n.stretch||"stretch",this.featureSettings=n.featureSettings||"normal"}var p=[];if(window.MutationObserver){var m=document.createElement("div");new MutationObserver(a).observe(m,{attributes:!0});var v=function(){m.setAttribute("x",0)}}else v=function(){setTimeout(a)};var g=2;if(s.prototype.resolve=function(t){var e=this;if(e.a===g){if(t===e)throw new TypeError("Promise settled with itself.");var n=!1;try{var i=t&&t.then;if(null!==t&&"object"==typeof t&&"function"==typeof i)return void i.call(t,function(t){n||e.resolve(t),n=!0},function(t){n||e.reject(t),n=!0})}catch(o){return void(n||e.reject(o))}e.a=0,e.b=t,u(e)}},s.prototype.reject=function(t){if(this.a===g){if(t===this)throw new TypeError("Promise settled with itself.");this.a=1,this.b=t,u(this)}},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.then=function(t,e){var n=this;return new s(function(i,o){n.c.push([t,e,i,o]),u(n)})},window.Promise){var y=window.Promise;y.prototype.then=window.Promise.prototype.then,y.prototype.catch=window.Promise.prototype["catch"],y.all=window.Promise.all,y.race=window.Promise.race,y.resolve=window.Promise.resolve,y.reject=window.Promise.reject}else y=s,y.prototype.then=s.prototype.then,y.prototype.catch=s.prototype.catch,y.all=h,y.race=d,y.resolve=l,y.reject=c;var w=null;f.prototype.a=function(i,r){var a=i||"BESbswy",s=r||3e3,c="font-style:"+this.style+";font-variant:"+this.variant+";font-weight:"+this.weight+";font-stretch:"+this.stretch+";font-feature-settings:"+this.featureSettings+";-moz-font-feature-settings:"+this.featureSettings+";-webkit-font-feature-settings:"+this.featureSettings+";",l=document.createElement("div"),u=new e(a),h=new e(a),d=new e(a),f=-1,p=-1,m=-1,v=-1,g=-1,k=-1,E=this;return new y(function(e,i){function r(){null!==l.parentNode&&l.parentNode.removeChild(l)}function a(){if((-1!==f&&-1!==p||-1!==f&&-1!==m||-1!==p&&-1!==m)&&(f===p||f===m||p===m)){if(null===w){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);w=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}w?f===v&&p===v&&m===v||f===g&&p===g&&m===g||f===k&&p===k&&m===k||(r(),e(E)):(r(),e(E))}}t(function(){function t(){if(Date.now()-e>=s)r(),i(E);else{var n=document.hidden;(!0===n||void 0===n)&&(f=u.a.offsetWidth,p=h.a.offsetWidth,m=d.a.offsetWidth,a()),setTimeout(t,50)}}var e=Date.now();n(u,"sans-serif",c),n(h,"serif",c),n(d,"monospace",c),l.appendChild(u.a),l.appendChild(h.a),l.appendChild(d.a),document.body.appendChild(l),v=u.a.offsetWidth,g=h.a.offsetWidth,k=d.a.offsetWidth,t(),o(u,function(t){f=t,a()}),n(u,E.family+",sans-serif",c),o(h,function(t){p=t,a()}),n(h,E.family+",serif",c),o(d,function(t){m=t,a()}),n(d,E.family+",monospace",c)})})},window.FontFaceObserver=f,window.FontFaceObserver.prototype.check=f.prototype.a}(),function(){"use strict";function t(e,i){function o(t,e){return function(){return t.apply(e,arguments)}}var r;if(i=i||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=i.touchBoundary||10,this.layer=e,this.tapDelay=i.tapDelay||200,this.tapTimeout=i.tapTimeout||700,!t.notNeeded(e)){for(var a=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],s=this,c=0,l=a.length;l>c;c++)s[a[c]]=o(s[a[c]],s);n&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,i){var o=Node.prototype.removeEventListener;"click"===t?o.call(e,t,n.hijacked||n,i):o.call(e,t,n,i)},e.addEventListener=function(t,n,i){var o=Node.prototype.addEventListener;"click"===t?o.call(e,t,n.hijacked||(n.hijacked=function(t){t.propagationStopped||n(t)}),i):o.call(e,t,n,i)}),"function"==typeof e.onclick&&(r=e.onclick,e.addEventListener("click",function(t){r(t)},!1),e.onclick=null)}}var e=navigator.userAgent.indexOf("Windows Phone")>=0,n=navigator.userAgent.indexOf("Android")>0&&!e,i=/iP(ad|hone|od)/.test(navigator.userAgent)&&!e,o=i&&/OS 4_\d(_\d)?/.test(navigator.userAgent),r=i&&/OS [6-7]_\d/.test(navigator.userAgent),a=navigator.userAgent.indexOf("BB10")>0;t.prototype.needsClick=function(t){switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(i&&"file"===t.type||t.disabled)return!0;break;case"label":case"iframe":case"video":return!0}return/\bneedsclick\b/.test(t.className)},t.prototype.needsFocus=function(t){switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!n;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},t.prototype.sendClick=function(t,e){var n,i;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),i=e.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(t),!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,t.dispatchEvent(n)},t.prototype.determineEventType=function(t){return n&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},t.prototype.focus=function(t){var e;i&&t.setSelectionRange&&0!==t.type.indexOf("date")&&"time"!==t.type&&"month"!==t.type?(e=t.value.length,t.setSelectionRange(e,e)):t.focus()},t.prototype.updateScrollParent=function(t){var e,n;if(e=t.fastClickScrollParent,!e||!e.contains(t)){n=t;do{if(n.scrollHeight>n.offsetHeight){e=n,t.fastClickScrollParent=n;break}n=n.parentElement}while(n)}e&&(e.fastClickLastScrollTop=e.scrollTop)},t.prototype.getTargetElementFromEventTarget=function(t){return t.nodeType===Node.TEXT_NODE?t.parentNode:t},t.prototype.onTouchStart=function(t){var e,n,r;if(t.targetTouches.length>1)return!0;if(e=this.getTargetElementFromEventTarget(t.target),n=t.targetTouches[0],i){if(r=window.getSelection(),r.rangeCount&&!r.isCollapsed)return!0;if(!o){if(n.identifier&&n.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=t.timeStamp,this.targetElement=e,this.touchStartX=n.pageX,this.touchStartY=n.pageY,t.timeStamp-this.lastClickTime<this.tapDelay&&t.preventDefault(),!0},t.prototype.touchHasMoved=function(t){var e=t.changedTouches[0],n=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>n||Math.abs(e.pageY-this.touchStartY)>n?!0:!1},t.prototype.onTouchMove=function(t){return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(t.target)||this.touchHasMoved(t))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},t.prototype.findControl=function(t){return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},t.prototype.onTouchEnd=function(t){var e,a,s,c,l,u=this.targetElement;if(!this.trackingClick)return!0;if(t.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;if(t.timeStamp-this.trackingClickStart>this.tapTimeout)return!0;if(this.cancelNextClick=!1,this.lastClickTime=t.timeStamp,a=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,r&&(l=t.changedTouches[0],u=document.elementFromPoint(l.pageX-window.pageXOffset,l.pageY-window.pageYOffset)||u,u.fastClickScrollParent=this.targetElement.fastClickScrollParent),s=u.tagName.toLowerCase(),"label"===s){if(e=this.findControl(u)){if(this.focus(u),n)return!1;u=e}}else if(this.needsFocus(u))return t.timeStamp-a>100||i&&window.top!==window&&"input"===s?(this.targetElement=null,!1):(this.focus(u),this.sendClick(u,t),i&&"select"===s||(this.targetElement=null,t.preventDefault()),!1);return i&&!o&&(c=u.fastClickScrollParent,c&&c.fastClickLastScrollTop!==c.scrollTop)?!0:(this.needsClick(u)||(t.preventDefault(),this.sendClick(u,t)),!1)},t.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},t.prototype.onMouse=function(t){return this.targetElement?t.forwardedTouchEvent?!0:t.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),t.preventDefault(),!1):!0:!0},t.prototype.onClick=function(t){var e;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===t.target.type&&0===t.detail?!0:(e=this.onMouse(t),e||(this.targetElement=null),e)},t.prototype.destroy=function(){var t=this.layer;n&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},t.notNeeded=function(t){var e,i,o,r;if("undefined"==typeof window.ontouchstart)return!0;if(i=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!n)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(i>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(a&&(o=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/),o[1]>=10&&o[2]>=3&&(e=document.querySelector("meta[name=viewport]")))){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}return"none"===t.style.msTouchAction||"manipulation"===t.style.touchAction?!0:(r=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1],r>=27&&(e=document.querySelector("meta[name=viewport]"),e&&(-1!==e.content.indexOf("user-scalable=no")||document.documentElement.scrollWidth<=window.outerWidth))?!0:"none"===t.style.touchAction||"manipulation"===t.style.touchAction?!0:!1)},t.attach=function(e,n){return new t(e,n)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return t}):"undefined"!=typeof module&&module.exports?(module.exports=t.attach,module.exports.FastClick=t):window.FastClick=t}(),function(){"use strict";FastClick.attach(document.body);var t=[],e=new FontFaceObserver("pt"),n=new FontFaceObserver("pt",{style:"italic"});t.push(e.check(null,5e3)),t.push(n.check(null,5e3)),Promise.all(t).then(function(){document.documentElement.className+=" fonts-loaded"},function(){document.documentElement.className+=" fonts-unavailable"})}();</script></body></html>